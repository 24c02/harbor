<div class="scrapyard-leaderboard">
  <h1>Scrapyard Leaderboard</h1>

  <div class="sort-controls">
    Sort by:
    <%= link_to "Total Time", scrapyard_leaderboards_path(sort: 'total'), 
        class: "sort-link #{@sort_by == 'total' ? 'active' : ''}" %>
    |
    <%= link_to "Average Time", scrapyard_leaderboards_path(sort: 'average'), 
        class: "sort-link #{@sort_by == 'average' ? 'active' : ''}" %>
  </div>

  <% @event_stats.each_with_index do |stats, index| %>
    <div class="event-card">
      <h2>
        <%= link_to scrapyard_leaderboard_path(stats[:event]) do %>
          <% case index %>
          <% when 0 %>
            ðŸ¥‡
          <% when 1 %>
            ðŸ¥ˆ
          <% when 2 %>
            ðŸ¥‰
          <% else %>
            <span class="ordinal"><%= (index + 1).ordinalize %></span>
          <% end %>
          <%= stats[:event].name %>
        <% end %>
      </h2>
      <div class="stats">
        <div class="stat">
          <label>Coding Time:</label>
          <span>
            <% if stats[:total_seconds] > 0 %>
              <span class="<%= @sort_by == 'total' ? 'active-sort' : '' %>">
                <%= short_time_detailed(stats[:total_seconds]) %>
              </span>
              <span class="average <%= @sort_by == 'average' ? 'active-sort' : '' %>">
                (<%= short_time_detailed(stats[:average_seconds_per_attendee]) %> avg)
              </span>
            <% else %>
              <span class="no-time">No time logged</span>
            <% end %>
          </span>
        </div>
        <div class="stat">
          <label>Hackatime users / Attendees:</label>
          <span>
            <%= stats[:hackatime_users] %>/<%= stats[:total_attendees] %>
            <% percent = (stats[:hackatime_users].to_f / stats[:total_attendees] * 100) %>
            (<%= percent < 1 ? "%.1f" % percent : percent.to_i %>%)
          </span>
        </div>
      </div>
    </div>
  <% end %>
</div>

<% content_for :head do %>
  <style>
    .scrapyard-leaderboard {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }

    .scrapyard-leaderboard h1 {
      margin-top: 0;
    }

    .sort-controls {
      margin-bottom: 20px;
      text-align: left;
    }

    .sort-link {
      color: inherit;
      text-decoration: none;
      opacity: 0.7;
      transition: opacity 0.2s;
      padding: 4px 8px;
    }

    .sort-link:hover {
      opacity: 1;
    }

    .sort-link.active {
      opacity: 1;
      font-weight: bold;
    }

    .event-card {
      background: var(--uchu-light-green);
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .event-card h2 {
      margin: 0 0 15px 0;
    }

    .event-card h2 a {
      color: inherit;
      text-decoration: none;
    }

    .event-card h2 a:hover {
      text-decoration: underline;
    }

    .ordinal {
      font-size: 0.9em;
      opacity: 0.7;
      font-weight: normal;
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
    }

    .stat {
      display: flex;
      flex-direction: column;
    }

    .stat label {
      font-size: 0.9em;
      opacity: 0.8;
    }

    .stat span {
      font-size: 1.2em;
      font-weight: bold;
    }

    .stat .average {
      font-size: 0.9em;
      opacity: 0.8;
      font-weight: normal;
      margin-left: 4px;
    }

    .stat .no-time {
      opacity: 0.7;
      font-weight: normal;
    }

    .active-sort {
      font-weight: bold !important;
      opacity: 1 !important;
    }
  </style>
<% end %> 